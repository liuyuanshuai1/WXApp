好——下面我把**API 接口文档（含请求/响应示例） + 返回码规范**一次性生成好，开发者可以直接拿去建库与联调。文档以 RESTful 风格给出，默认鉴权为 `Authorization: Bearer <jwt>`（或使用微信 openId 做会话标识），时间字段统一使用 UTC ISO 8601 格式（示例：`2025-10-18T10:00:00Z`）。

------

# 一、鉴权与通用约定

- 鉴权：`Authorization: Bearer <jwt>`（如果用微信登录，可把 openId 放在 token payload 中）
- Content-Type：`application/json`（图片上传使用 multipart/form-data）
- 时间格式：`YYYY-MM-DDTHH:mm:ssZ`（UTC）
- ID 类型：`VARCHAR(36)` 存 UUID（也可改为 bigint 自增）
- 分页：`page`（默认1），`size`（默认20）
- 错误响应统一格式：

```json
{
  "code": 40001,
  "message": "错误描述",
  "data": null
}
```

------

# 二、返回码规范（示例）

| code  | 含义                       |
| ----- | -------------------------- |
| 0     | 成功                       |
| 10001 | 参数错误                   |
| 10002 | 未认证/登录失效            |
| 10003 | 权限不足                   |
| 10004 | 资源不存在                 |
| 10005 | 资源已存在                 |
| 20001 | 积分不足                   |
| 20002 | 库存不足                   |
| 30001 | 数据库操作失败（事务回滚） |
| 50000 | 服务端错误                 |

------

# 三、API 接口文档（关键接口，含请求/响应示例）

> 备注：`<jwt>`代表登录后取得的 token；`userId` 可从 token 中解出，或由前端上传。

------

## 1. 家庭模块

### 1.1 创建家庭

- URL: `POST /api/family/create`
- Auth: 必须
- 请求 body:

```json
{
  "familyName": "元帅之家"
}
```

- 响应（200）:

```json
{
  "code": 0,
  "message": "success",
  "data": {
    "familyId": "uuid",
    "familyCode": "ABCD12",
    "createTime": "2025-10-18T10:00:00Z"
  }
}
```

### 1.2 加入家庭

- URL: `POST /api/family/join`
- 请求 body:

```json
{
  "familyCode": "ABCD12",
  "role": "child" // 可选，后端可默认 child
}
```

- 响应示例:

```json
{ "code": 0, "message": "加入成功", "data": { "familyId": "fam_001" } }
```

### 1.3 获取家庭信息（含成员）

- URL: `GET /api/family/{familyId}`
- 响应 data 包含 family 与成员数组

------

## 2. 成员模块

### 2.1 列出成员

- URL: `GET /api/family/{familyId}/members`
- 响应示例:

```json
{ "code":0,"data":[{"id":"mem1","nickname":"小明","role":"child"}] }
```

------

## 3. 任务模块

### 3.1 发布任务（家长）

- URL: `POST /api/task/create`
- 请求 body:

```json
{
  "familyId":"fam_001",
  "title":"完成作业",
  "description":"数学练习册第3页",
  "points":10,
  "type":"daily", // daily | normal
  "deadline":"2025-10-31T23:59:59Z",
  "repeatable": true
}
```

- 响应:

```json
{ "code":0,"data":{"taskId":"task_uuid"} }
```

### 3.2 获取任务列表

- URL: `GET /api/task/list?familyId=fam_001&userId=user_002&status=available&page=1&size=20`
- 响应示例: 列表的任务并包含用户当前任务状态

### 3.3 提交任务证明（孩子）

- URL: `POST /api/task/submit`
- 请求 body:

```json
{
  "taskId":"task_001",
  "proofText":"已完成",
  "proofImageUrls":["https://.../img1.jpg"]
}
```

- 响应:

```json
{ "code":0,"data":{"submissionId":"sub_uuid","status":"pending"} }
```

> 图片上传：前端先上传到文件存储（如云存储），得到 URL，再提交以上接口。

### 3.4 审核任务（家长）

- URL: `POST /api/task/review`
- 请求 body:

```json
{
  "submissionId":"sub_uuid",
  "approved": true,
  "remark":"做得不错"
}
```

- 响应（审核通过逻辑）：
  - 若 approved=true：后端在事务内写入 `points_log` 并更新用户余额（或统一用聚合计算），返回成功。
  - 若 approved=false：回复驳回并可将状态设回 `available`（若可重复）。

------

## 4. 积分与流水模块

### 4.1 查询余额

- URL: `GET /api/points/balance?userId=user_002`
- 响应:

```json
{ "code":0, "data": { "balance": 150 } }
```

### 4.2 查询流水

- URL: `GET /api/points/logs?userId=user_002&page=1&size=20`
- 响应：流水数组，按时间降序

------

## 5. 奖励模块

### 5.1 创建奖励（家长）

- URL: `POST /api/reward/create`
- 请求 body:

```json
{
  "familyId":"fam_001",
  "title":"周末看电影",
  "pointsRequired":50,
  "type":"privilege",
  "stock":3
}
```

- 响应: 返回 rewardId

### 5.2 列表（孩子端）

- URL: `GET /api/reward/list?familyId=fam_001`
- 响应: 奖励数组（包含是否可兑换字段：`canExchange`）

### 5.3 申请兑换（孩子）

- URL: `POST /api/reward/exchange`
- 请求 body:

```json
{
  "rewardId":"r_001",
  "userId":"user_002"
}
```

- 核心逻辑（后端建议）：
  1. 在事务中检查当前用户积分是否足够；检查 reward.stock > 0；若通过则：
     - 创建 `exchange` 记录，状态 `pending`；
     - 锁定库存（`UPDATE reward SET stock = stock - 1 WHERE id=? AND stock>0` 校验行数）或者将 stock -> stock_locked 字段增量（两种方案任选其一）。
  2. 返回 `exchangeId` 给前端并通知家长审核。
- 响应:

```json
{ "code":0, "data": { "exchangeId": "ex_001", "status": "pending" } }
```

### 5.4 审核兑换（家长）

- URL: `POST /api/reward/review`
- 请求 body:

```json
{
  "exchangeId":"ex_001",
  "approved": true,
  "remark":"已通过"
}
```

- 核心逻辑：
  - 若 approved=true：在事务中写入 `points_log`（扣减），更新 `exchange.status = approved`，若有 stock_locked 则 finalize。
  - 若 approved=false：`exchange.status = rejected`，返还库存（增加 stock）并通知孩子，同时记录原因。

------

如果你愿意，我可以再为你做两件事（任选其一或都要）：

1. 把上面的 API 用 **OpenAPI/Swagger (YAML)** 格式输出，方便直接生成服务端/客户端代码；
2. 生成**部分关键接口的示例实现**（例如：`/api/reward/exchange` 的 Spring Boot + MyBatis 实现示例，含事务与行锁示例）。

要哪个我现在就开始直接输出（无需你再确认）？